---
title: "Epidemiologia de la salud mental mundial"
subtitle: "Datos de 1990 a 2017"
output: html_document
---

```{r setup, include=FALSE, echo=FALSE}
knitr::opts_chunk$set()
```

```{r lectura, eval=TRUE, echo=FALSE, include=FALSE}

if (!require("tidyverse")) install.packages('DT')
library(tidyverse) 

df <- read.csv(file = 'C:/Users/Felipe/Desktop/Proyectos/CoderHouse/R/Proyecto Final/epidemiologia_aguirre.csv')

# Cambiar nombre columnas
df <- df %>%
  rename(Index = ï..,
         Schizophrenia = Schizophrenia....,
         Bipolar.disorder = Bipolar.disorder....,
         Eating.disorders = Eating.disorders....,
         Anxiety.disorders = Anxiety.disorders....,
         Alcohol.use.disorders = Alcohol.use.disorders....,
         Drug.use.disorders = Drug.use.disorders....,
         Depression = Depression....)

```

# Introduccion

El presente informe resume los datos obtenidos en censos de salud mental de 196 paises en todo el mundo en un periodo de 28 años, desde 1990 a 2017.

Los datos fueron obtenidos de <https://ourworldindata.org/>


### Breve analisis de las dimensiones del dataset y de los datos faltantes
```{r resumen_dataset, eval=TRUE, echo=FALSE}

descripcion <- function(x){
  
  print(paste("Nro de columnas del df: ", length(colnames(x))))
  print(paste("Nro de filas del df: ", nrow(x)))
  print(paste("Cantidad de valores faltantes en el df: ", sum(!complete.cases(df))))

}

descripcion(df)



```


### Paises participantes

```{r instalaciones, eval=TRUE, echo=FALSE, include=FALSE}
if (!require("DT")) install.packages('DT')
library(DT)

```

```{r resumen_paises, eval=TRUE, echo=FALSE}
df_intro <- df[, c("Year", "Entity")]
df_intro <- df_intro%>%group_by(Entity)%>%summarise(Year = mean(Year))
DT::datatable(df_intro[,1])
```

### Diagnosticos evaluados
```{r resumen_dx, eval=TRUE, echo=FALSE}
colnames(df)[5:length(colnames(df))]
```
# Comparación entre países

El gráfico a continuacion representa la diferencia en prevalencia total de trastornos mentales entre paises, seleccionando el top 5 paises de mayor prevalencia (primeros 5 paises del grafico) y el top 5 de menor prevalencia (ultimos 5 paises del grafico). Esto permite concluir que algunos paises tienen el doble de prevalencia de trastornos mentales.

Por ejemplo, nacer en Groenlandia implica el doble de chances de desarollar un trastorno mental que al nacer en las Filipinas.


```{r agrupacion_pais, eval=TRUE, echo=FALSE}
if (!require("ggplot2")) install.packages('ggplot2')
library(ggplot2)

df_pais <- mutate(df, Prevalencia_Total = Depression + Schizophrenia + Bipolar.disorder +
               Eating.disorders + Anxiety.disorders + Alcohol.use.disorders + Drug.use.disorders)%>%
              group_by(Entity)%>% 
              summarise(prevalenciaTotal = mean(Prevalencia_Total))
df_pais <- df_pais[order(-df_pais$prevalenciaTotal),]

# Plot
df_paisTopBotton <- rbind(df_pais[1:5,], df_pais[length(df_pais$Entity)-5:length(df_pais$Entity),])
df_paisTopBotton <- df_paisTopBotton[1:10,]
df_paisTopBotton <- df_paisTopBotton[order(-df_paisTopBotton$prevalenciaTotal),]


ggplot(df_paisTopBotton[1:10,], aes(x = prevalenciaTotal, y = reorder(Entity, prevalenciaTotal),fill=factor(ifelse(Entity == df_paisTopBotton$Entity[1:5],"Top 5","Botton 5")))) + geom_col(width = 0.7)+ labs(title = "PREVALENCIA POR PAIS", subtitle = "Primeros 5 vs ultimos 5", y = "Pais", x = "Prevalencia (%)") +
  geom_bar(stat="identity") +
  scale_fill_manual(name = "Paises", values=c("grey50","red"))



```

# Comparación entre años

Puede observarse como la prevalencia total en todo el mundo no cambio significativamente. De todas formas, puede observarse un aumento de un poco mas del 0.1% desde el comienzo de los '90 hasta el 2017.

```{r resumen_year, eval=TRUE, echo=FALSE}


df_year <- mutate(df, Prevalencia_Total = Depression + Schizophrenia + Bipolar.disorder +
               Eating.disorders + Anxiety.disorders + Alcohol.use.disorders + Drug.use.disorders)%>%
              group_by(Year)%>% 
              summarise(prevalenciaTotal = mean(Prevalencia_Total))

cat("Aumento de la prevalencia total mundial desde 1990 a 2017 : ", df_year$prevalenciaTotal[10] - df_year$prevalenciaTotal[1], "%")

# Plot
ggplot(df_year, aes(x = Year, y = prevalenciaTotal)) + geom_point() + labs(title = "PREVALENCIA TOTAL POR AÑO", subtitle = "En todo el mundo", y = "Prevalencia (%)", x = "Año") + coord_cartesian(xlim = c(1990, 2017), ylim = c(10, 12))




```


# Comparación entre años por tipo de enfermedad

Puede observarse como cada uno de los trastornos mantiene su prevalencia a lo largo de los años.

```{r year_dx, eval=TRUE, echo=FALSE}

df_year <- df[, c("Year", "Schizophrenia", "Eating.disorders", "Drug.use.disorders", "Alcohol.use.disorders", "Bipolar.disorder", "Anxiety.disorders", "Depression")]

df_year <- mutate(df_year, Prevalencia_Total = Depression + Schizophrenia + Bipolar.disorder +
               Eating.disorders + Anxiety.disorders + Alcohol.use.disorders + Drug.use.disorders)%>%
              group_by(Year)%>% 
              summarise(across(everything(), mean))


# Plot

colors <- c("Schizophrenia" = "blue", "Depression" = "red", "Bipolar.disorder" = "cornsilk", "Eating.disorders" = "green", "Alcohol.use.disorders" = "cyan", "Anxiety.disorders" = "darkgoldenrod3", "Drug.use.disorders" = "darkviolet")


ggplot(df_year, aes(x = Year)) +
    geom_line(aes(y = Schizophrenia, color = "Schizophrenia"), size = 1.1) +
    geom_line(aes(y = Bipolar.disorder, color = "Bipolar.disorder"), size = 1.1) +
    geom_line(aes(y = Depression, color = "Depression"), size = 1.1) +
    geom_line(aes(y = Anxiety.disorders, color = "Anxiety.disorders"), size = 1.1) +
    geom_line(aes(y = Eating.disorders, color = "Eating.disorders"), size = 1.1) +
    geom_line(aes(y = Alcohol.use.disorders, color = "Alcohol.use.disorders"), size = 1.1) +
    geom_line(aes(y = Drug.use.disorders, color = "Drug.use.disorders"), size = 1.1) +
    labs(x = "Year",
         y = " Prevalencia (%)",
         color = "Legend") +
    scale_color_manual(values = colors) + labs(title = "PREVALENCIA MUNDIAL", subtitle = "Por año y por trastorno", y = "Prevalencia (%)", x = "Año")




```

Sin embargo, puede existir un cambio real en la prevalencia tan pequeño que resulte inobservable en un grafico. Veamos el cambio en cada uno de los diagnosticos.

```{r analisis_dx, eval=TRUE, echo=FALSE}

diferencias <- c()
columna <- c()

for(i in 2:(ncol(df_year)-1)) {       # for-loop over columns
  diferencias[i] <- df_year[10, i] - df_year[1, i]
  columna[i] <- colnames(df_year)[i]
  
}

for(i in 2:length(diferencias)) {       # for-loop over columns
  print(paste("Para el diagnostico ", columna[i], " la prevalencia aumento en un %",  diferencias[i]," entre 1990 y 2017"))
}


```

# El caso del trastorno por consumo de sustancias.

El analisis anterior refleja que el trastorno por consumo de sustancias es el cuadro que mas aumento en prevalencia en las ultimas decadas, concretamente en un %0.043. Esto puede parecer poco, sin embargo, estamos hablando de la prevalencia mundial, por lo que este pequeño aumento se traduce en millones de nuevos casos.

Al graficarlo, observamos mejor como su prevalencia aumenta.

```{r year_dx_especifico, eval=TRUE, echo=FALSE}

df_year <- mutate(df_year, Prevalencia_Total = Depression + Schizophrenia + Bipolar.disorder +
               Eating.disorders + Anxiety.disorders + Alcohol.use.disorders + Drug.use.disorders)%>%
              group_by(Year)%>% 
              summarise(across(everything(), mean))

# Plot
ggplot(df_year, aes(x = Year, y = Drug.use.disorders)) + geom_point() + labs(title = "PREVALENCIA DE TRASTORNO POR CONSUMO DE SUSTANCIAS", subtitle = "En todo el mundo, por año", y = "Prevalencia (%)", x = "Año") + coord_cartesian(xlim = c(1990, 2017), ylim = c(0.5, 1))


```

# El caso de la Argnentina.

A lo largo de las decadas, la prevalencia de todos los trastornos mentales aumenta muy gradualmente.

```{r tablaSumarizadaArg, eval=TRUE, echo=FALSE}
library(knitr)
df_Arg <- mutate(df, Prevalencia_Total = Depression + Schizophrenia + Bipolar.disorder +
               Eating.disorders + Anxiety.disorders + Alcohol.use.disorders + Drug.use.disorders)%>%
              filter(Entity %in% c('Argentina'))%>%
              select(c(Entity, Year, Prevalencia_Total))%>%
              group_by(Year)%>% 
              summarise('Argentina', across(c('Prevalencia_Total'), mean))
# Plot
kable(df_Arg)


```


Tomando como referencia a nuetros vecinos.


```{r tablaSumarizadaArgChile, eval=TRUE, echo=FALSE}

df_ArgChile <- mutate(df, Prevalencia_Total = Depression + Schizophrenia + Bipolar.disorder +
               Eating.disorders + Anxiety.disorders + Alcohol.use.disorders + Drug.use.disorders)%>%
              filter(Entity %in% c('Argentina','Chile'))%>%
              select(c(Entity, Year, Prevalencia_Total))%>%
              group_by(Entity)%>% 
              summarise(media = mean(Prevalencia_Total), varianza = var(Prevalencia_Total))

# Plot
kable(df_ArgChile)
```



